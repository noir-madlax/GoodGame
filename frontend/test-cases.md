# Dashboard 统计口径修复 - 测试用例

## 测试环境
- **项目ID**: kctuxiejpwykosghunib  
- **数据范围**: 近7天
- **测试时间**: 2025-10-28

## 预期数据（基于SQL查询结果）

### 基础数据
| 指标 | 数值 |
|------|------|
| 总内容数 | 1811 |
| 相关内容 | 426 |
| 疑似相关 | 13 |
| 不相关 | 1372 |
| 营销 | 0 |
| 高优先级内容 | 6 |

---

## 测试用例1: 总内容数卡片
**测试目标**: 验证总内容数卡片的主数值和细分数据

### 1.1 主数值测试
- **测试项**: 总内容数显示  
- **预期结果**: 1811
- **测试方法**: 前端UI检查

### 1.2 细分数据测试
- **测试项**: 相关性分布  
- **预期结果**:
  - 相关: 426
  - 疑似相关: 13
  - 不相关: 1372
  - 营销: 0

---

## 测试用例2: 相关内容卡片
**测试目标**: 验证相关内容卡片的主数值和严重度分布（修复重点）

### 2.1 主数值测试
- **测试项**: 相关内容总数显示  
- **预期结果**: 426
- **测试方法**: 前端UI检查

### 2.2 严重度分布测试（重点）
- **测试项**: 相关内容中的严重度分布  
- **预期结果**:
  - 高: 6 条（而不是0）
  - 中: 20 条（而不是0）
  - 低: 398 条
  - 未标注: 2 条
- **修复前问题**: 显示全部为0，因为统计的是全局严重度而非相关内容的严重度
- **修复后逻辑**: 只统计相关性="相关"的内容的严重度分布

---

## 测试用例3: 高优先级内容卡片
**测试目标**: 验证高优先级内容卡片的主数值和细分数据

### 3.1 主数值测试
- **测试项**: 高优先级内容总数显示  
- **预期结果**: 6
- **测试方法**: 前端UI检查

### 3.2 创作者分布测试
- **测试项**: 高优先级内容的创作者分布  
- **预期结果**:
  - 达人: 0
  - 素人: 0
  - 未标注: 6
- **修复前问题**: 显示全部为0，因为基于前端数组（可能不完整）统计
- **修复后逻辑**: 使用SQL统计的结果

### 3.3 平台分布测试
- **测试项**: 高优先级内容的平台分布  
- **预期结果**:
  - 抖音: 0
  - 小红书: 6
  - 其他: 0

---

## 测试用例4: 一级图表（内容分布）
**测试目标**: 验证内容分布饼图的数据

### 4.1 数据测试
- **测试项**: 各相关性类别的数量  
- **预期结果**:
  - 相关: 426
  - 疑似相关: 13
  - 不相关: 1372 (注意: 1367不相关 + 5无关应合并)
  - 营销: 0

---

## 测试用例5: 二级图表（内容优先级分布）
**测试目标**: 验证点击"相关"后的严重度分布图表（修复重点）

### 5.1 点击"相关"后
- **测试项**: 标题显示  
- **预期结果**: "相关"的内容 共426条内容

- **测试项**: 严重度柱状图数据  
- **预期结果**:
  - 高: 6 条
  - 中: 20 条
  - 低: 398 条
  - 未标注: 2 条
- **修复前问题**: 显示"共10条内容"，因为基于前端数组统计
- **修复后逻辑**: 使用SQL预先统计的 severityByRelevance 数据

### 5.2 右侧统计卡片
- **测试项**: 优先级统计卡片显示的数量  
- **预期结果**: 与图表一致
  - 高: 6
  - 中: 20
  - 低: 398

### 5.3 点击"疑似相关"后
- **测试项**: 严重度分布  
- **预期结果**:
  - 高: 0
  - 中: 0
  - 低: 12
  - 未标注: 1
  - 总数: 13条

### 5.4 点击"不相关"后
- **测试项**: 严重度分布  
- **预期结果**:
  - 高: 0
  - 中: 0
  - 低: 0
  - 未标注: 1372
  - 总数: 1372条

---

## 测试用例6: 三级图表（创作者类型与平台分布）
**测试目标**: 验证点击"相关" -> "高"后的创作者和平台分布

### 6.1 数据测试
- **测试项**: 标题显示  
- **预期结果**: 共6条内容

- **测试项**: 创作者和平台分布  
- **预期结果**:
  - 未标注-小红书: 6
  - 达人-小红书: 0
  - 素人-小红书: 0
  - (抖音相关): 0

---

## 关键修复点总结

### 修复点1: 相关内容卡片的严重度统计
- **修复前**: 使用 `globalSeverityCounts`（全局统计，分母=1811）
- **修复后**: 使用 `globalRelevantSeverityCounts`（只统计相关类别，分母=426）
- **影响**: 高中低数值从0变为6/20/398

### 修复点2: 高优先级卡片的细分统计
- **修复前**: 遍历 `globalPostsLite` 数组（可能被筛选过）
- **修复后**: 使用 `globalHighPriorityBreakdown`（SQL统计）
- **影响**: 确保数据准确性和一致性

### 修复点3: 二级图表的总数显示
- **修复前**: 使用 `filtered.length`（前端数组长度，可能只有10条）
- **修复后**: 使用 `globalSeverityByRelevance[相关].total`（SQL count=426）
- **影响**: 显示从"共10条"变为"共426条"

---

## 测试执行计划

1. ✅ **测试环境准备**: 确认测试环境和数据
2. ✅ **编译检查**: 确保代码无编译错误
3. 🔄 **功能测试**: 按照用例逐项测试
4. 🔄 **问题修复**: 如发现问题立即修复
5. 🔄 **回归测试**: 修复后重新测试

---

## 测试执行记录

### 测试轮次1: 初始测试
- **时间**: 2025-10-28
- **测试人**: AI Assistant
- **测试结果**: 待执行

