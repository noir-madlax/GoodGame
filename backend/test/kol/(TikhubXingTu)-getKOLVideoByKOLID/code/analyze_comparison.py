import json
import sys
from pathlib import Path

def analyze_comparison():
    # 1. Define input paths
    script_dir = Path(__file__).resolve().parent
    # Output dir from previous step
    output_dir = script_dir.parent / 'output' 
    summary_file = output_dir / 'mid_tier_execution_summary.json'
    
    if not summary_file.exists():
        print(f"Error: Summary file not found at {summary_file}")
        return

    # 2. Load new API data
    print("Loading new API data...")
    new_data_map = {} # kol_id -> {videos: [], stats: {}}
    
    # Load detail files based on summary
    with open(summary_file, 'r', encoding='utf-8') as f:
        summary_list = json.load(f)
        
    for item in summary_list:
        kol_id = item['kol_id']
        detail_file = output_dir / f"kol_videos_{kol_id}.json"
        if detail_file.exists():
            with open(detail_file, 'r', encoding='utf-8') as f:
                detail_json = json.load(f)
                api_resp = detail_json.get('api_response', {}).get('data', {})
                if not isinstance(api_resp, dict): api_resp = {}
                
                videos = []
                # Add masterpiece videos
                mp_list = api_resp.get('masterpiece_videos', [])
                if mp_list:
                    for v in mp_list:
                        v['source_type'] = 'masterpiece'
                        videos.append(v)
                
                # Add newest video
                newest = api_resp.get('newest_video')
                if newest:
                    newest['source_type'] = 'newest'
                    videos.append(newest)
                    
                # Add hot video
                hot = api_resp.get('personal_hot_video')
                if hot:
                    hot['source_type'] = 'hot'
                    videos.append(hot)
                
                new_data_map[kol_id] = {
                    "nickname": item['nickname'],
                    "videos": videos,
                    "video_ids": set(str(v.get('id')) for v in videos if v.get('id'))
                }

    # 3. Load DB data (hardcoded from previous SQL result for simplicity in this script context)
    # In a real app, this would be queried dynamically or passed as a file.
    print("Loading DB data...")
    
    # Using the untrusted data structure from the prompt history
    # kol_id, item_id, item_title, like_cnt
    db_rows = [
        {"kol_id":"6744563381727920141","item_id":"7091601027811659015","item_title":"#å¥½ç‰©åˆ†äº« ##æŠ¤è‚¤åˆ†äº« æ¥äº†å‘¦~#å¥½ç‰©æ¨èğŸ”¥  ","like_cnt":456},
        {"kol_id":"6744563381727920141","item_id":"6953036285346991390","item_title":"èº«ä½“é˜²æ™’æ€ä¹ˆæ´—ï¼Ÿâ€¦ æ²æµ´æ²¹æµ‹è¯•æ¥äº† #èº«ä½“é˜²æ™’ @DOU+å°åŠ©æ‰‹","like_cnt":4493},
        {"kol_id":"6744563381727920141","item_id":"6890140808599686407","item_title":"ä¸å¡”èŠ™æ´é¢â€¦è¯•è¯•?","like_cnt":5542},
        {"kol_id":"6744563381727920141","item_id":"6887834411719576839","item_title":"ç‚æ¶¦é¢éœœ...æµ‹è¯„","like_cnt":7494},
        {"kol_id":"6744563381727920141","item_id":"7040005453534743808","item_title":"ç§‹å†¬å¿…å¤‡æŠ¤è‚¤å“â€¦æ˜¯å®ƒï¼Ÿï¼","like_cnt":764},
        {"kol_id":"6744563381727920141","item_id":"7038515807789255971","item_title":"#é»‘å¤´ å¾ˆé—æ†¾â€¦æ— æ³•å»æ‰","like_cnt":1283},
        {"kol_id":"6744563381727920141","item_id":"6957497975790783744","item_title":"å­¦ç”Ÿå…šå¿…å¤‡â€¦è´µä»·æ´—é¢å¥¶ä¹Ÿå°±è¿™ä½“éªŒå¥½å— #å¤šèŠ¬æ´—é¢å¥¶","like_cnt":5480},
        {"kol_id":"6744563381727920141","item_id":"6893370346330672392","item_title":"æ´—è„¸åå¯ä»¥åªæ“¦ç²¾åå—","like_cnt":2958},
        {"kol_id":"6744563381727920141","item_id":"6889341939854871823","item_title":"åŒ11å¿…ä¹°å›½è´§â€¦å­¦ç”Ÿå…šçœ‹è¿‡æ¥","like_cnt":10587},
        {"kol_id":"6744563381727920141","item_id":"6887074547300961549","item_title":"æ‚¦è¯—é£åŸç«å±±æ³¥è†œâ€¦æµ‹è¯„","like_cnt":2900},
        {"kol_id":"6852500018742427651","item_id":"7530512699894631738","item_title":None,"like_cnt":None},
        {"kol_id":"6852500018742427651","item_id":"7552087861408386313","item_title":None,"like_cnt":None},
        {"kol_id":"6852500018742427651","item_id":"7526514112366431545","item_title":None,"like_cnt":None},
        {"kol_id":"6852500018742427651","item_id":"7555065118032383289","item_title":None,"like_cnt":None},
        {"kol_id":"6852500018742427651","item_id":"7571309759732376741","item_title":None,"like_cnt":None},
        {"kol_id":"6852500018742427651","item_id":"7518731015562251578","item_title":None,"like_cnt":None},
        {"kol_id":"6852500018742427651","item_id":"7515253932881366332","item_title":"ä»Šå¤©ä¸‹åˆ2ç‚¹åœ¨æ¬§é˜³å°å·å¼€æ’­é€ç¤¼ï¼Œå‡†å¤‡äº†åƒä»½åˆ«é”™è¿‡@æ¬§é˜³ç™½æµ…é­…åŠ›é›…å§¿ç»†èƒé¥®å·¥å‚ è¿™ä¸ªå·","like_cnt":67},
        {"kol_id":"6852500018742427651","item_id":"7506819874154302758","item_title":"30å²ä»¥åå¥³äººéƒ½ä¸å–å¥¶èŒ¶äº†ï¼Œéƒ½åœ¨å–è¿™ä¸ªã€‚ #é­…åŠ›é›…å§¿ #ç‡•çªè™«è‰èƒ¶åŸè›‹ç™½è‚½ #å¥½å–ä¸è´µ #618æŠ–éŸ³å•†åŸ","like_cnt":29},
        {"kol_id":"6852500018742427651","item_id":"7515254785492667708","item_title":"å–œæ41äº†ï¼Œè·¯è¿‡çš„èƒ½ç¥æˆ‘ç”Ÿæ—¥å¿«ä¹å—ï¼Ÿè¿˜æœ‰ä¸ªå¥½æ¶ˆæ¯ï¼Œä»Šå¤©åœ¨æ¬§é˜³å°å·æœ‰ç¤¼å“é€å“¦ã€‚@æ¬§é˜³ç™½æµ…é­…åŠ›é›…å§¿ç»†èƒé¥®å·¥å‚ è¿™ä¸ªå·","like_cnt":57},
        {"kol_id":"6852500018742427651","item_id":"7514345945804623162","item_title":"é©¬ä¸Šå°±41å²äº†ï¼Œ13å·æˆ‘ç”Ÿæ—¥ä½ ä»¬ä¼šæ¥å—ï¼Ÿæˆ‘åœ¨å°å·ç»™ä½ ä»¬å‡†å¤‡äº†1000ä»½ç¤¼å“ã€‚@æ¬§é˜³ç™½æµ…é­…åŠ›é›…å§¿ç»†èƒé¥®å·¥å‚","like_cnt":61},
        {"kol_id":"6870161674108665870","item_id":"7518966752262163770","item_title":None,"like_cnt":None},
        {"kol_id":"6870161674108665870","item_id":"7425934749224455450","item_title":"è·Ÿä¸ªé£ï¼#æ´»å‡ºè‡ªå·±å–œæ¬¢çš„æ ·å­","like_cnt":62},
        {"kol_id":"6870161674108665870","item_id":"7409947017381694758","item_title":"ä¸€ç¨‹å±±ï¼Œä¸€ç¨‹æ°´ï¼Œåƒå¸†é˜…å°½ï¼Œæ„¿æˆ‘ä»¬éƒ½èƒ½ä¸âœ¨æ›´å¥½çš„è‡ªå·±ç›¸é‡#åŠªåŠ›æˆä¸ºæ›´å¥½çš„è‡ªå·± #é€†é¾„æŠ—è¡°","like_cnt":40},
        {"kol_id":"6870161674108665870","item_id":"7406909567617043764","item_title":"ä¿„ç½—æ–¯ä¹‹æ—…ï¼#ä¸æƒ§æ—¶å…‰ä¼˜é›…åˆ°è€ #æ´»å‡ºè‡ªå·±å–œæ¬¢çš„æ ·å­","like_cnt":36},
        {"kol_id":"6870161674108665870","item_id":"7519496778791685433","item_title":None,"like_cnt":None},
        {"kol_id":"6870161674108665870","item_id":"7548399666665737532","item_title":None,"like_cnt":None},
        {"kol_id":"6870161674108665870","item_id":"7463799981405752635","item_title":"ç¥çœ‹åˆ°è§†é¢‘çš„äºº2025å®¶åº­å¹¸ç¦ï¼Œè´¢ç¥é“ºè·¯ï¼Œå¹¸è¿ä¹‹ç¥å¸¸æ¥å…‰é¡¾å®¶è´¢ä¸‡è´¯è´µäººåŠ©ï¼#è¿‡å¹´å°±è¦ç¾ç¾å“’ #æ–°å¹´å€’è®¡æ—¶","like_cnt":68},
        {"kol_id":"6870161674108665870","item_id":"7417087605310868787","item_title":"é©¬æ¥è¥¿äºšğŸ‡²ğŸ‡¾ä¹‹æ—…å¾ˆå“‡å¡çš„ä¸€å¤©ï¼","like_cnt":46},
        {"kol_id":"6870161674108665870","item_id":"7401495836712045839","item_title":"","like_cnt":40},
        {"kol_id":"6870161674108665870","item_id":"7398552941809945856","item_title":"ä¸Šæµ·æ»©çœŸçš„å¾ˆç¾ï¼","like_cnt":37},
        {"kol_id":"6957967843048554533","item_id":"7349404046991625523","item_title":"å¦‚ä½•çœé’±åšå‡ºæ¼‚äº®è‚Œè‚¤ï¼Œæˆ‘æ¥æ•™æ‚¨#å¥½ç‰©æ¨èğŸ”¥ #æŠ¤è‚¤åˆ†äº« #æŠ¤è‚¤å°çŸ¥è¯†","like_cnt":195},
        {"kol_id":"6957967843048554533","item_id":"7348669453191613733","item_title":"#æŠ¤è‚¤åˆ†äº« æ˜¥å¤©å¦‚ä½•æ­£ç¡®æŠ¤è‚¤#è‡ªç”¨å¥½ç‰©åˆ†äº« #å¥½ç‰©æ¨èğŸ”¥","like_cnt":94},
        {"kol_id":"7004243194900643871","item_id":"7326078994972052763","item_title":None,"like_cnt":None},
        {"kol_id":"7004243194900643871","item_id":"7564232345973407867","item_title":"è¿™å°±æ˜¯æˆå¹´äººpro maxçš„é­…åŠ›å—ï¼Œæœ‰äº†ä»–ç§‹å†¬è¿˜éœ€è¦å•¥å¤§æ£‰è¢„#åˆå†¬çš„å¯’å†·è¢«é¦™å‘³æ•‘èµäº† #æˆ‘å®¶å‡†å¤‡å¥½å…¥å†¬äº† #ç§‹å†¬æ´—æŠ¤ #æƒ…ä¾£","like_cnt":9889},
        {"kol_id":"7004243194900643871","item_id":"7330264615693176127","item_title":None,"like_cnt":None},
        {"kol_id":"7004243194900643871","item_id":"7572395574918948773","item_title":"â€œä¸‰åˆ†é’Ÿçƒ­åº¦â€ä½“éªŒä¹‹ç©¿å›å†·å®«å½“å¨˜å¨˜#èš•ä¸ç»‡æˆçš„ä¸œæ–¹ç¾å­¦ #éé—æœ‰å¥½ç‰© #æŠ–éŸ³éé—è®¡åˆ’ #ç™¾youngéé—è®¡åˆ’ #å˜è£…","like_cnt":2783},
        {"kol_id":"7004243194900643871","item_id":"7562854946870824226","item_title":"åŒåä¸€åƒä¸‡åˆ«é”™è¿‡YSLç²‰æ°”å«ï¼Œéšæ‰‹ä¸€æ‹åº•å¦†æ°´æ¶¦åˆæ— ç‘•ï¼#å¹²çš®æ°”å«#é€šå‹¤å¦†å®¹#YSLç²‰æ°”å«#æ°”å«åˆ†äº«#åŒåä¸€è´­ç‰©","like_cnt":736},
        {"kol_id":"7004243194900643871","item_id":"7547922939904609593","item_title":"çœŸç²—å¿ƒï¼Œæ‰‹æœºä¸€æ‰ç›´æ¥ç¥ç€æµå…‰ç©¿è¶Šåˆ°é¢å¥–ç¤¼äº†#ç¥ç€ç³» #ç¥ç€æµå…‰ #åˆç§‹å¿…å­¦çš„ç¥ç€å¦† #å˜è£… #çº¢æ¯¯","like_cnt":1454},
        {"kol_id":"7004243194900643871","item_id":"7540193888494161215","item_title":"åŒé¢äººç”Ÿå‰§æœ¬éœ€è¦çš„æ˜¯é•¿æœŸæ¼‚äº®\\n#æŠ¤è‚¤ #CPBé’»å…‰æ°´ä¹³ #CPBé’»å…‰ç²¾åæ°´ #å¹´è½»æ˜¯æ—©æ™šçš„äº‹","like_cnt":3532},
        {"kol_id":"7004243194900643871","item_id":"7556083098536103226","item_title":"æ—…æ¸¸é‚ªä¿®å°±æ˜¯çˆ½ï¼Œå›½åº†å‡ºæ¸¸æœ‰è¿™å‡ æ‹›å¹¸ç¦æ„Ÿç›´æ¥æ‹‰æ»¡#å‡ºç‰‡ç©¿æ­è®°å½•å›½åº†é«˜å…‰æ—¶åˆ»#æ—…æ¸¸æ”»ç•¥#é‚ªä¿®#æ‡’äººå¿…å¤‡","like_cnt":2602},
        {"kol_id":"7004243194900643871","item_id":"7553934574805175612","item_title":"è€å…¬åŸºç¡€ï¼Œé€ç¤¼å°±ä¸èƒ½åŸºç¡€#ç‡•ä¹‹å±‹ç²¾ç‚–ç‡•çªç¤¼ç›’#å‘ç°å®è—å¥åº·æˆåˆ†#æŠ–éŸ³å•†åŸè¶…çº§å“ç‰Œæ—¥#é€ç¤¼æŒ‡å—#æƒ…ä¾£æ—¥å¸¸","like_cnt":1081},
        {"kol_id":"7004243194900643871","item_id":"7553189986326809871","item_title":"ä¸‰åå²ä¾æ—§é²œæ´»åˆçƒ­çƒˆ#è‡ªç„¶å¥åº·è‡ªæœ‰è¶Šæ´»è¶Šæ¼‚äº®çš„èŠ‚å¥#æ–¯ç»´è¯—åŒ€äº®å°ç²‰ç“¶PRO#Swisseå¤©çŒ«è¶…çº§å“ç‰Œæ—¥#æ–¯ç»´è¯—","like_cnt":2630},
        {"kol_id":"7004243194900643871","item_id":"7545479751683788091","item_title":"YSLä¸Šæ–°ï¼çœŸçš„all-inäº†ï¼Œé©æ–°å°é‡‘æ¡å…¨å‘˜ç¾åˆ°çª’æ¯ï¼ï¼#é©æ–°yslå°é‡‘æ¡#yslå°é‡‘æ¡#ysl1936","like_cnt":1536},
        {"kol_id":"7004243194900643871","item_id":"7539493971963677952","item_title":"è£¸é—¨åœ°éœ‡~èƒ½æŒç®¡å£çº¢ç¾å­¦çš„è¿˜å¾—æ˜¯#é›…è¯—å…°é»›ä¸é›¾å°é‡‘ç®¡#é›…è¯—å…°é»›382#é›…è¯—å…°é»›420","like_cnt":5376},
        {"kol_id":"7097417916731260958","item_id":"7507537797318774031","item_title":None,"like_cnt":None},
        {"kol_id":"7097417916731260958","item_id":"7497161729835568423","item_title":"1 1 ","like_cnt":4},
        {"kol_id":"7097417916731260958","item_id":"7485993527638330636","item_title":"1 1","like_cnt":19},
        {"kol_id":"7097417916731260958","item_id":"7430091841069993253","item_title":"ä½†å‡¡æ—©ç‚¹çŸ¥é“è¿™ä¸ªï¼Œä¹Ÿä¸ä¼šè¢«ç—˜ç—˜é»‘å¤´ç²‰åˆºå›°æ‰°è¿™ä¹ˆä¹…äº†ï¼Œè„¸ä¸Šé•¿ç—˜ï¼Œå¤§æ²¹ç”°ï¼Œè¯•è¯•è¿™ä¸ªç¡«ç£ºæ´é¢ä¹³ï¼Œå‡€ç—˜æ§æ²¹ï¼#æ´—é¢å¥¶","like_cnt":1085},
        {"kol_id":"7097417916731260958","item_id":"7428131030629928219","item_title":"ä½†å‡¡æ—©ç‚¹çŸ¥é“è¿™ä¸ªï¼Œä¹Ÿä¸ä¼šè¢«ç—˜ç—˜é»‘å¤´ç²‰åˆºå›°æ‰°è¿™ä¹ˆä¹…äº†ï¼Œè„¸ä¸Šé•¿ç—˜ï¼Œå¤§æ²¹ç”°ï¼Œè¯•è¯•è¿™ä¸ªç¡«ç£ºæ´é¢ä¹³ï¼Œå‡€ç—˜æ§æ²¹ï¼#æ´—é¢å¥¶","like_cnt":6},
        {"kol_id":"7097417916731260958","item_id":"7539761466283478312","item_title":None,"like_cnt":None},
        {"kol_id":"7097417916731260958","item_id":"7492621968181693715","item_title":"1 1 ","like_cnt":6},
        {"kol_id":"7097417916731260958","item_id":"7429266337878248740","item_title":"é€‰å¯¹æ´—é¢å¥¶çœŸçš„å¾ˆé‡è¦ï¼Œæ²¹ç”°å¿…å¤‡çš„æ´—é¢å¥¶ï¼Œè®©ä½ æ¸…æ¸…çˆ½æ¯ä¸€å¤©#æ´—é¢å¥¶æ¨è#ç”·å¥³é€šç”¨","like_cnt":21},
        {"kol_id":"7097417916731260958","item_id":"7428572540970290441","item_title":"é€‰å¯¹æ´—é¢å¥¶çœŸçš„å¾ˆé‡è¦ï¼Œæ²¹ç”°å¿…å¤‡çš„æ´—é¢å¥¶ï¼Œè®©ä½ æ¸…æ¸…çˆ½æ¯ä¸€å¤©#æ´—é¢å¥¶æ¨è","like_cnt":264},
        {"kol_id":"7097417916731260958","item_id":"7428117314597375268","item_title":"ä½†å‡¡æ—©ç‚¹çŸ¥é“è¿™ä¸ªï¼Œä¹Ÿä¸ä¼šè¢«ç—˜ç—˜é»‘å¤´ç²‰åˆºå›°æ‰°è¿™ä¹ˆä¹…äº†ï¼Œè„¸ä¸Šé•¿ç—˜ï¼Œå¤§æ²¹ç”°ï¼Œè¯•è¯•è¿™ä¸ªç¡«ç£ºæ´é¢ä¹³ï¼Œå‡€ç—˜æ§æ²¹ï¼#æ´—é¢å¥¶","like_cnt":10},
        {"kol_id":"7135664853816967181","item_id":"7547613987140144427","item_title":None,"like_cnt":None},
        {"kol_id":"7135664853816967181","item_id":"7554654183421529370","item_title":None,"like_cnt":None},
        {"kol_id":"7135664853816967181","item_id":"7566604691158857082","item_title":None,"like_cnt":None},
        {"kol_id":"7135664853816967181","item_id":"7562814038988688703","item_title":"ä½ çš„è„¸åœ¨å·å·ç»™ä½ è®°è´¦ #è‡´å¥³äºº #ç¾å®¹ #æŠ¤è‚¤ #ä¿å…» #æµ”å§¿ @DOU+å°åŠ©æ‰‹","like_cnt":24},
        {"kol_id":"7135664853816967181","item_id":"7562105052593261863","item_title":"4æ¡æŠ¤è‚¤å¿ å‘Š #æŠ¤è‚¤åˆ†äº« #é¿å‘æŒ‡å— #çš®è‚¤é—®é¢˜ #æ—¥å¸¸ä¿å…» #æµ”å§¿ @DOU+å°åŠ©æ‰‹","like_cnt":19},
        {"kol_id":"7135664853816967181","item_id":"7561958364662500662","item_title":"ä¸¤ç±»æ´—é¢å¥¶åƒä¸‡åˆ«ä¹° #å®ä½“åº—è€æ¿å¨˜ #æ´—é¢å¥¶ #æŠ¤è‚¤å“é¿å‘æŒ‡å— #æŠ¤è‚¤ #æµ”å§¿ @DOU+å°åŠ©æ‰‹","like_cnt":18},
        {"kol_id":"7135664853816967181","item_id":"7561216993580371254","item_title":"é•¿æœŸä¿å…» #æŠ¤è‚¤ #å˜ç¾ @DOU+å°åŠ©æ‰‹","like_cnt":18},
        {"kol_id":"7135664853816967181","item_id":"7507444934665850171","item_title":None,"like_cnt":None},
        {"kol_id":"7135664853816967181","item_id":"7561977631713922323","item_title":None,"like_cnt":None},
        {"kol_id":"7135664853816967181","item_id":"7563977831730974015","item_title":None,"like_cnt":None},
        {"kol_id":"7135664853816967181","item_id":"7563813341655829779","item_title":"#ç¾ä¸šè€æ¿ #é€†è¢­ä¹‹è·¯å˜ç¾å˜å¥½çœ‹ #æŠ¤è‚¤ #ä¿å…» #æµ”å§¿","like_cnt":20},
        {"kol_id":"7135664853816967181","item_id":"7562448910485163300","item_title":"æƒ³çš®è‚¤å¥½ï¼Œè¿™3ç‚¹å¾ˆé‡è¦ï¼ #çš®è‚¤ç®¡ç† #å˜ç¾ #æŠ¤è‚¤åˆ†äº« #é˜²æ™’ #æµ”å§¿ @DOU+å°åŠ©æ‰‹","like_cnt":34},
        {"kol_id":"7135664853816967181","item_id":"7561615693456706859","item_title":"30å²åä¸€å®šä¸è¦ç”¨ä¹³æ¶²ï¼ #æŠ—è¡°è€ #æ—¥å¸¸ä¿å…» #çš®è‚¤ç®¡ç† #å˜ç¾é€†è¢­ @æµ”å§¿@DOU+å°åŠ©æ‰‹","like_cnt":18},
        {"kol_id":"7279399698954190885","item_id":"7287137292781767971","item_title":"#ä¸Šçƒ­é—¨è¯é¢˜ æ¢å­£æŠ¤è‚¤åˆ†äº«ä¹‹æ°´æ²¹åŒè¡¥æ³•#å¹²è´§åˆ†äº« #æŠ¤è‚¤","like_cnt":11},
        {"kol_id":"7279399698954190885","item_id":"7285924966795676962","item_title":"åŠŸæ•ˆæŠ¤è‚¤ä¹‹ç¥›ç—˜ç¯‡ç« é˜²æ­¢çƒ‚è„¸çœ‹è¿‡æ¥#ç—˜ç—˜è‚Œ #æŠ¤è‚¤ #æ‹¯æ•‘ç—˜ç—˜è‚Œ","like_cnt":7},
        {"kol_id":"7279399698954190885","item_id":"7284824065339067663","item_title":"åŠŸæ•ˆæŠ¤è‚¤ä¹‹ç¥›é»‘å¤´ç²‰åˆº#æŠ¤è‚¤ #é—­å£ç²‰åˆº #å¹²è´§åˆ†äº«","like_cnt":8},
        {"kol_id":"7279399698954190885","item_id":"7283306204590312756","item_title":"å®å¦ˆçœ‹è¿‡æ¥#å¹²è´§åˆ†äº« #æŠ¤è‚¤ #è‚²å„¿ç»éªŒåˆ†äº«","like_cnt":104},
        {"kol_id":"7279399698954190885","item_id":"7281471549381561635","item_title":"å­¦ä¼šåŒ–å¦†å“çš„æˆåˆ†è¡¨è®©ä½ çœé’±æ‹’ç»å¿½æ‚ #æŠ¤è‚¤ #å¹²è´§åˆ†äº« #æŠ¤è‚¤åˆ†äº« #ç§‘å­¦æŠ¤è‚¤","like_cnt":9},
        {"kol_id":"7279399698954190885","item_id":"7286296997596826914","item_title":"åŠŸæ•ˆæŠ¤è‚¤ä¹‹ç¾ç™½æ·¡æ–‘ç¯‡#å¹²è´§åˆ†äº« #ç¾ç™½æ·¡æ–‘ #æŠ¤è‚¤","like_cnt":11},
        {"kol_id":"7279399698954190885","item_id":"7284434006945369344","item_title":"åˆ©ç”¨å›½åº†å‡æœŸ8å¤©ç»™çš®è‚¤æå‡ä¸€ä¸‹#æŠ¤è‚¤ #çš®è‚¤ç®¡ç† #æŠ¤è‚¤å¹²è´§","like_cnt":7},
        {"kol_id":"7279399698954190885","item_id":"7284102357921697076","item_title":"é€‰æ‹©åŠŸæ•ˆæ€§æŠ¤è‚¤å¦‚ä½•å¿…å‘å‘¢ï¼Ÿ#æŠ¤è‚¤ #å¹²è´§åˆ†äº« #æŠ¤è‚¤åˆ†äº«","like_cnt":6},
        {"kol_id":"7279399698954190885","item_id":"7281873452963794210","item_title":"é«˜åˆ†å­èƒ¶æˆåˆ†è¯†åˆ«æŠ¤è‚¤çš„æ–¹æ³•#æŠ¤è‚¤ #å¹²è´§åˆ†äº« #ç§‘å­¦æŠ¤è‚¤","like_cnt":6},
        {"kol_id":"7279399698954190885","item_id":"7281104226955103528","item_title":"æœªæ¥æœ€é‡è¦çš„æŠ¤è‚¤æ­¥éª¤è‚Œåº•æ¶²#æŠ¤è‚¤ #å¹²è´§åˆ†äº«","like_cnt":3},
        {"kol_id":"7489955985092509706","item_id":"7563496012174593330","item_title":None,"like_cnt":None},
        {"kol_id":"7489955985092509706","item_id":"7549505933815074075","item_title":None,"like_cnt":None},
        {"kol_id":"7489955985092509706","item_id":"7562014524270841114","item_title":None,"like_cnt":None},
        {"kol_id":"7489955985092509706","item_id":"7566155583020125455","item_title":None,"like_cnt":None},
        {"kol_id":"7489955985092509706","item_id":"7562014101392690458","item_title":"ä»£è¡¨æ–°å›½è´§ç›´æ’­æ¦œæ ·èµ°è¿›å¤®è§†ï¼Œæ¥å—é‡‡è®¿ï¼Œå›½è´§å¼ºåˆ™ä¸­å›½å¼ºï¼ #é‡‡è®¿  #å¤®è§†  #æ–°å›½è´§  #æŠ¤è‚¤å“","like_cnt":3},
        {"kol_id":"7489955985092509706","item_id":"7562515332976413979","item_title":None,"like_cnt":None},
        {"kol_id":"7489955985092509706","item_id":"7566155842710424847","item_title":None,"like_cnt":None},
        {"kol_id":"7489955985092509706","item_id":"7562515218685873454","item_title":"#å›½è´§  ä»¥æ•¬ç•ä¹‹å¿ƒåšäº§å“ï¼Œä»¥èµ¤è¯šä¹‹å¿ƒå®ˆè¡Œä¸šï¼ˆå®ˆä¸€ä»½åˆå¿ƒï¼Œé€ ä¸€ä»½å®‰å¿ƒï¼‰","like_cnt":3},
        {"kol_id":"7489955985092509706","item_id":"7562014322189176115","item_title":"ä»¥å‰¯ä¼šé•¿å•ä½ä¸ºæ–°èº«ä»½ï¼Œè·µè¡Œè´¨é‡å®‰å…¨æ‰¿è¯ºã€‚ä¸­å›½ä¼ ç»Ÿæ¤ç‰©åŸæ–™ï¼Œæ‰“é€ æ•æ„Ÿè‚ŒæŠ¤è‚¤æ–°æ ‡æ†#äº§å“å®‰å…¨  #å“è´¨å›½è´§","like_cnt":2},
        {"kol_id":"7489955985092509706","item_id":"7562013978478628146","item_title":"ï¼ˆä¸Šï¼‰å¤®è§†å¯¹è¯ç‹å¥•äº­ã€‚å…±åŒé¢†ç•¥æ–°å›½è´§ç‹¬ç‰¹é­…åŠ›ä¸å“è¶Šå®åŠ›ã€‚ #é‡‡è®¿  #å¤®è§†  #æ–°å›½è´§  #æŠ¤è‚¤å“","like_cnt":3},
        {"kol_id":"7489955985092509706","item_id":"7562013838648904998","item_title":"ï¼ˆä¸‹ï¼‰å¤®è§†å¯¹è¯ç‹å¥•äº­ã€‚å…±åŒé¢†ç•¥æ–°å›½è´§ç‹¬ç‰¹é­…åŠ›ä¸å“è¶Šå®åŠ›ã€‚ #é‡‡è®¿  #å¤®è§†  #æ–°å›½è´§  #æŠ¤è‚¤å“","like_cnt":1}
    ]
    
    db_data_map = {}
    for row in db_rows:
        kid = row['kol_id']
        if kid not in db_data_map:
            db_data_map[kid] = []
        db_data_map[kid].append(row)

    # 4. Perform comparison
    print("\nAnalyzing differences...")
    print("="*60)
    
    total_new_videos = 0
    
    for kol_id, kol_data in new_data_map.items():
        nickname = kol_data['nickname']
        new_videos = kol_data['videos']
        new_ids = kol_data['video_ids']
        
        db_videos = db_data_map.get(kol_id, [])
        db_ids = set(v['item_id'] for v in db_videos)
        
        # Diff
        unique_in_api = new_ids - db_ids
        unique_in_db = db_ids - new_ids
        intersection = new_ids & db_ids
        
        print(f"\nğŸ‘¤ KOL: {nickname} (ID: {kol_id})")
        print(f"   - APIè¿”å›è§†é¢‘æ•°: {len(new_videos)}")
        print(f"   - DBå·²æœ‰è§†é¢‘æ•°: {len(db_videos)}")
        print(f"   - ğŸ†• APIæ–°å¢å‘ç°: {len(unique_in_api)}")
        print(f"   - ğŸ”™ DBç‹¬æœ‰(APIæœªè¿”): {len(unique_in_db)}")
        print(f"   - ğŸ”„ é‡åˆæ•°é‡: {len(intersection)}")
        
        if unique_in_api:
            total_new_videos += len(unique_in_api)
            print("   - ğŸ“ æ–°å¢è§†é¢‘è¯¦æƒ… (Top 3):")
            added_details = [v for v in new_videos if str(v.get('id')) in unique_in_api]
            for v in added_details[:3]:
                print(f"     * [{v.get('source_type')}] {v.get('title', 'No Title')} (Like: {v.get('stats', {}).get('like_cnt')})")
                
        # Check data updates for intersection
        updates = []
        for vid in intersection:
            api_v = next(v for v in new_videos if str(v.get('id')) == vid)
            db_v = next(v for v in db_videos if v['item_id'] == vid)
            
            api_like = int(api_v.get('stats', {}).get('like_cnt', 0))
            db_like = db_v.get('like_cnt')
            if db_like is None: db_like = 0
            else: db_like = int(db_like)
            
            if abs(api_like - db_like) > 10: # Only show significant diff
                updates.append(f"ID {vid}: Like {db_like} -> {api_like}")
                
        if updates:
            print(f"   - ğŸ“‰ æ•°æ®å·®å¼‚ (Likeæ•°æ›´æ–°): {len(updates)} æ¡")
            # for u in updates[:3]:
            #     print(f"     * {u}")

    print("\n" + "="*60)
    print("ğŸ“Š æ€»ä½“åˆ†æ")
    print(f"- å‚ä¸å¯¹æ¯”KOLæ•°: {len(new_data_map)}")
    print(f"- APIå‘ç°æ€»æ–°å¢è§†é¢‘æ•°: {total_new_videos}")
    print("="*60)
    
if __name__ == "__main__":
    analyze_comparison()

