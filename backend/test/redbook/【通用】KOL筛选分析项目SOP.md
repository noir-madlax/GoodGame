# KOL筛选与分析项目 Runbook

> **版本**: v1.0  
> **最后更新**: 2025-12-11  
> **适用平台**: 小红书KOL分析  
> **执行方式**: 通过Cursor AI Agent逐步执行

---

## 📋 项目概述

本Runbook用于指导完成小红书KOL筛选与分析项目，包含从候选名单到最终推荐报告的完整流程。

### 整体流程图

```
┌─────────────────┐
│ 阶段0: 项目初始化 │ ← 准备候选名单、创建目录
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段1: KOL ID获取 │ ← 昵称→ID转换
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段2: 基础筛选数据 │ ← 3个API获取初筛数据
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段3: 人工筛选决策 │ ← Review数据，确定进入下一阶段的KOL
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段4: 详细数据获取 │ ← 7个API获取完整数据
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段5: 数据维度分析 │ ← 六维度评分+排名
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段6: 内容能力分析 │ ← 视频获取→下载→AI分析
└────────┬────────┘
         ▼
┌─────────────────┐
│ 阶段7: 综合报告生成 │ ← 整合所有分析，输出交付报告
└─────────────────┘
```

### 预计资源消耗

| 阶段 | API调用数 | 预计耗时 | 主要成本 |
|------|-----------|----------|----------|
| 阶段1 | N次搜索 | 1-2分钟 | JustOneAPI |
| 阶段2 | N×3次 | 2-3分钟 | JustOneAPI |
| 阶段4 | M×7次 | 3-5分钟 | JustOneAPI |
| 阶段6 | 视频数×1 | 10-30分钟 | Gemini API |

> N=候选KOL数，M=筛选后KOL数

---

## 阶段0: 项目初始化

### 📥 输入要求

1. **KOL候选名单**（必需）
   - 格式：KOL昵称列表，每行一个
   - 来源：MCN机构、品牌方、手动收集
   - 示例：
     ```
     哩哩Lilyy
     帝都星光海归
     汤圆小玩子
     vikk啦啦啦
     ...
     ```

2. **项目背景信息**（必需）
   - 品牌/产品名称
   - 产品类型（家居、美妆、健康食品等）
   - 目标受众特征
   - 特殊筛选要求（如需要口播能力、需要出镜等）

3. **参考项目**（可选）
   - 如有历史项目可参考其目录结构

### 🎯 执行步骤

**Prompt模板**：
```
我需要创建一个新的KOL分析项目，用于为【品牌/产品名称】筛选合适的小红书KOL。

项目背景：
- 品牌：【品牌名称】
- 产品类型：【产品类型】
- 目标受众：【受众描述】

候选KOL名单（共X位）：
【粘贴KOL昵称列表】

请参考 @backend/test/redbook/pillow-kol-analysis 这个项目的结构，为我创建新项目：
1. 在 @backend/test/redbook/ 下创建项目目录（中文命名）
2. 创建完整的目录结构
3. 将KOL名单写入需求文档和kol_list.json
4. 创建执行步骤文档

先不要执行任何API调用，只创建目录和文档。
```

### 📤 产出文件

```
{项目名称}/
├── 00_需求和设计/
│   ├── 原始需求.md          # KOL名单+分析维度+筛选标准
│   ├── 执行步骤.md          # 各阶段详细步骤
│   └── API调用优化方案.md   # API分阶段调用策略
├── 01_KOL数据获取/
│   ├── kol_list.json        # KOL列表（初始只有昵称）
│   ├── search_results/      # 搜索结果存放目录
│   ├── 01_基础筛选数据/     # 阶段2数据
│   └── 02_详细数据/         # 阶段4数据
├── 02_数据分析/
│   └── output/              # 分析报告输出
├── 03_内容分析/
│   ├── 00_设计文档/
│   ├── 01_脚本/
│   ├── 02_视频数据/
│   ├── 03_分析结果/
│   └── prompts/
├── 04_综合报告/
│   └── output/
└── README.md
```

### ✅ 验证方法

1. 检查目录结构是否完整
2. 确认 `kol_list.json` 包含所有候选KOL
3. 确认 `原始需求.md` 包含完整的项目背景

### ⚠️ 注意事项

- 项目目录使用中文命名便于识别
- kol_list.json 初始只有 `nickname` 字段
- 不要在此阶段执行任何API调用

---

## 阶段1: KOL ID获取

### 📥 输入要求

1. **已完成阶段0**
2. **kol_list.json** 包含所有候选KOL昵称
3. **API Token** 已配置在 `.env` 文件

### 🎯 执行步骤

**Prompt模板**：
```
请执行阶段1：KOL ID获取

项目路径：@backend/test/redbook/{项目名称}

要求：
1. 创建 fetch_kol_ids.py 脚本
2. 使用 /api/xiaohongshu/search-user/v2 搜索每个KOL
3. 匹配最佳结果（优先完全匹配昵称）
4. 更新 kol_list.json 添加 kol_id、matched_nickname、fans_count_search 字段
5. 保存每次搜索的原始结果到 search_results/ 目录

参考规范：@.cursor/rules/api-test.mdc
- 并发控制（3并发）
- 重试机制（3次）
- 增量保存结果
- 进度打印
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `01_KOL数据获取/fetch_kol_ids.py` | ID获取脚本 |
| `01_KOL数据获取/search_results/search_XX_昵称.json` | 每个KOL的搜索原始结果 |
| `01_KOL数据获取/kol_list.json`（更新） | 添加kol_id等字段 |

**kol_list.json 更新后格式**：
```json
{
  "kols": [
    {
      "nickname": "vikk啦啦啦",
      "kol_id": "59476bb282ec39663ed76f6a",
      "matched_nickname": "vikk啦啦啦",
      "fans_count_search": 60051
    }
  ]
}
```

### ✅ 验证方法

1. 检查 kol_list.json 中所有KOL是否都有 kol_id
2. 确认 search_results/ 目录下有对应数量的搜索结果文件
3. 检查匹配率（matched_nickname 是否与原始 nickname 一致）

### ⚠️ 注意事项

- 部分KOL可能搜索不到或匹配不准确，需要人工确认
- 如果昵称有特殊字符（如emoji），搜索时可能需要处理
- 保存搜索原始结果便于后续验证

---

## 阶段2: 基础筛选数据获取

### 📥 输入要求

1. **已完成阶段1**
2. **kol_list.json** 包含所有KOL的ID
3. 只获取有kol_id的KOL数据

### 🎯 执行步骤

**Prompt模板**：
```
请执行阶段2：基础筛选数据获取

项目路径：@backend/test/redbook/{项目名称}

要获取的3个API（用于初步筛选）：
1. kol_info - 基础信息（粉丝数、笔记数等）
2. kol_note_rate - 笔记表现（阅读中位数、超越同行比例等）
3. kol_fans_trend - 粉丝趋势（30天增减、活跃度等）

要求：
1. 创建 fetch_screening_data.py 脚本
2. 为每个KOL创建独立目录存放数据
3. 实现断点续传（跳过已获取的API）
4. 生成筛选汇总报告

参考规范：@.cursor/rules/api-test.mdc
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `01_KOL数据获取/fetch_screening_data.py` | 数据获取脚本 |
| `01_KOL数据获取/01_基础筛选数据/kol_{id}/kol_info.json` | 每个KOL的基础信息 |
| `01_KOL数据获取/01_基础筛选数据/kol_{id}/kol_note_rate.json` | 笔记表现数据 |
| `01_KOL数据获取/01_基础筛选数据/kol_{id}/kol_fans_trend.json` | 粉丝趋势数据 |
| `01_KOL数据获取/01_基础筛选数据/_fetched_record.json` | 获取记录（断点续传用） |
| `01_KOL数据获取/01_基础筛选数据/筛选分析报告.md` | 初步筛选报告 |

### ✅ 验证方法

1. 检查每个KOL目录是否有3个JSON文件
2. 打开JSON文件确认数据非空
3. 查看筛选分析报告，确认数据汇总正确

### ⚠️ 注意事项

- 部分KOL可能不是蒲公英博主，API会返回空数据
- 如果API返回错误，检查kol_id是否正确
- 保存 _fetched_record.json 用于断点续传

---

## 阶段3: 人工筛选决策

### 📥 输入要求

1. **已完成阶段2**
2. **筛选分析报告.md** 已生成

### 🎯 执行步骤

**Prompt模板**：
```
请帮我分析阶段2获取的数据，生成筛选建议。

项目路径：@backend/test/redbook/{项目名称}

筛选标准（可根据项目调整）：
1. 必须有近30天发帖记录（剔除不活跃账号）
2. 粉丝数据合理（阅读/粉丝比例正常）
3. 数据表现不为空

请：
1. 汇总所有KOL的关键数据
2. 标注哪些KOL需要排除及原因
3. 推荐进入下一阶段的KOL名单
4. 等我确认后再继续

不要自动执行下一阶段，等我review后确认。
```

**Review后的确认Prompt**：
```
确认排除以下KOL（原因：30天无发帖）：
- KOL名称1
- KOL名称2
- ...

保留以下X位KOL进入详细数据获取阶段：
- KOL名称A
- KOL名称B
- ...

请继续执行阶段4。
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `01_KOL数据获取/01_基础筛选数据/筛选分析报告.md`（更新） | 添加人工确认的筛选结论 |

### ✅ 验证方法

1. 确认筛选逻辑合理
2. 被排除的KOL原因明确
3. 保留的KOL数量在预期范围内

### ⚠️ 注意事项

- **这是需要人工决策的环节**，不要让AI自动执行
- 筛选标准可根据项目需求调整
- 记录排除原因，便于后续解释

---

## 阶段4: 详细数据获取

### 📥 输入要求

1. **已完成阶段3的人工确认**
2. **明确哪些KOL需要排除**

### 🎯 执行步骤

**Prompt模板**：
```
请执行阶段4：详细数据获取

项目路径：@backend/test/redbook/{项目名称}

排除的KOL ID列表：
- {id1}
- {id2}
- ...

要获取的7个详细API：
1. kol_fans_portrait - 粉丝画像
2. kol_fans_summary - 粉丝概览
3. kol_note_list - 笔记列表
4. kol_data_summary_v1 - 数据概览V1
5. kol_data_summary_v2 - 数据概览V2
6. kol_cost_effective - 性价比数据
7. kol_core_data - 核心数据

要求：
1. 创建 fetch_detail_data.py 脚本
2. 只为筛选通过的KOL获取数据
3. 实现断点续传
4. 最后合并所有数据到 _all_kol_data.json

参考规范：@.cursor/rules/api-test.mdc
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `01_KOL数据获取/fetch_detail_data.py` | 详细数据获取脚本 |
| `01_KOL数据获取/02_详细数据/kol_{id}/*.json` | 每个KOL的7个API数据 |
| `01_KOL数据获取/02_详细数据/_all_kol_data.json` | 合并后的完整数据 |
| `01_KOL数据获取/02_详细数据/_fetched_record.json` | 获取记录 |

### ✅ 验证方法

1. 检查每个KOL目录是否有7个JSON文件
2. 确认 _all_kol_data.json 包含所有筛选通过的KOL
3. 检查合并数据的完整性

### ⚠️ 注意事项

- 部分API可能返回空数据，属于正常情况
- kol_note_list 包含笔记列表，数据量较大
- 合并数据时注意处理空值

---

## 阶段5: 数据维度分析

### 📥 输入要求

1. **已完成阶段4**
2. **_all_kol_data.json** 或各KOL的详细数据文件

### 🎯 执行步骤

**Prompt模板**：
```
请执行阶段5：数据维度分析

项目路径：@backend/test/redbook/{项目名称}

六维度分析：
1. 粉丝增长趋势（30天增长率、趋势判断）
2. 发帖频率（每周发帖数、达标判断）
3. 数据表现（阅读/互动中位数、超越同行比例）
4. 粉丝vs数据比例（阅读/粉丝比、评论活跃度）
5. 爆文情况（爆文数量、爆文率）
6. 互动趋势（日均数据、趋势判断）

要求：
1. 创建 run_analysis.py 分析脚本
2. 计算各维度评分（参考评分标准）
3. 生成综合排名
4. 输出 综合分析报告.md

评分标准见参考项目的分析脚本。
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `02_数据分析/run_analysis.py` | 分析脚本 |
| `02_数据分析/output/综合分析报告.md` | 数据分析报告 |
| `02_数据分析/output/analysis_data.json` | 分析原始数据 |

### ✅ 验证方法

1. 查看综合分析报告，确认排名合理
2. 检查各维度数据是否正确计算
3. 确认评分逻辑符合预期

### ⚠️ 注意事项

- 部分字段可能是字符串需要转float，注意类型处理
- 空值需要有默认处理逻辑
- 评分标准可根据项目调整

---

## 阶段6: 内容能力分析

### 📥 输入要求

1. **已完成阶段5**
2. **人工确认进入内容分析的KOL名单**（通常是数据表现较好的3-5人）
3. **Gemini API Key** 已配置（GEMINI_API_KEY2, GEMINI_API_KEY3）

### 🎯 执行步骤

本阶段分三个子步骤：

#### 6.1 视频详情获取

**Prompt模板**：
```
请执行阶段6-1：视频详情获取

项目路径：@backend/test/redbook/{项目名称}

目标KOL（共X位，选择数据分析排名靠前+人工指定的）：
- KOL名称1
- KOL名称2
- ...

要求：
1. 创建 fetch_video_details.py 脚本
2. 从 kol_note_list 中筛选每人TOP5非广告视频
3. 调用 note_detail_solar API获取视频URL
4. 保存视频列表到 video_list.json

筛选规则：
- 只选视频类型（非图文）
- 排除广告笔记（is_ads=true）
- 按互动量排序取TOP5
```

#### 6.2 视频下载

**Prompt模板**：
```
请执行阶段6-2：视频下载

项目路径：@backend/test/redbook/{项目名称}

要求：
1. 创建 download_videos.py 脚本
2. 从 video_list.json 读取视频URL
3. 下载到 02_视频数据/{kol_id}/ 目录
4. 更新 video_list.json 添加下载状态和本地路径
5. 实现断点续传（跳过已下载）
```

#### 6.3 AI视频分析

**Prompt模板**：
```
请执行阶段6-3：AI视频分析

项目路径：@backend/test/redbook/{项目名称}

要求：
1. 创建 analyze_videos.py 脚本
2. 创建视频分析Prompt（参考pillow项目，修改品牌/产品相关描述）
3. 使用 GEMINI_API_KEY2 和 GEMINI_API_KEY3 两个key并行
4. 4并发处理
5. 实现断点续传（跳过已分析的视频）
6. 保存原始返回和解析后的JSON
7. 生成每个KOL的综合评估报告
8. 生成横向比较报告

三维度评估：
1. 形象与生活方式（与品牌契合度）
2. 剪辑能力
3. 口播能力

进度打印要求：上传、处理、分析、完成各阶段都要打印
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `03_内容分析/01_脚本/fetch_video_details.py` | 视频详情获取脚本 |
| `03_内容分析/01_脚本/download_videos.py` | 视频下载脚本 |
| `03_内容分析/01_脚本/analyze_videos.py` | AI分析脚本 |
| `03_内容分析/prompts/video_analysis_prompt.txt` | 分析Prompt模板 |
| `03_内容分析/02_视频数据/video_list.json` | 视频列表（含URL和本地路径） |
| `03_内容分析/02_视频数据/{kol_id}/*.mp4` | 下载的视频文件 |
| `03_内容分析/03_分析结果/kol_{id}/*_analysis.json` | 每个视频的分析结果 |
| `03_内容分析/03_分析结果/kol_{id}/*_raw_response.txt` | AI原始返回 |
| `03_内容分析/03_分析结果/kol_{id}/*_综合评估报告.md` | 每个KOL的评估报告 |
| `03_内容分析/03_分析结果/KOL横向比较报告.md` | 横向对比报告 |
| `03_内容分析/03_分析结果/KOL横向比较数据.json` | 对比数据JSON |

### ✅ 验证方法

1. 检查 video_list.json 视频数量是否正确（每人5个左右）
2. 确认视频文件下载完整（大小合理）
3. 检查分析结果JSON格式正确
4. 查看横向比较报告排名是否合理

### ⚠️ 注意事项

- **Gemini API有配额限制**，遇到429错误会自动重试
- 视频上传后有处理时间，需要等待ACTIVE状态
- 403错误通常是文件过期，重试即可
- JSON解析错误需要处理不完整的返回
- **一定要保存原始返回**，便于问题排查
- 分析Prompt需要根据品牌/产品修改相关描述

---

## 阶段7: 综合报告生成

### 📥 输入要求

1. **已完成所有前置阶段**
2. **数据分析报告** 和 **内容分析报告** 都已生成

### 🎯 执行步骤

**Prompt模板**：
```
请生成最终的综合交付报告

项目路径：@backend/test/redbook/{项目名称}

报告结构（参考pillow项目的交付报告）：
1. 项目概述
   - 评估流程图
   - 筛选漏斗
2. 数据层面分析
   - 综合排名表
   - 各维度数据详情
3. 内容能力分析
   - 三维度评估体系说明
   - 综合排名
   - 各维度TOP表现
   - 每个KOL详细分析
4. 最终推荐结论
   - 推荐汇总表
   - 各优先级建议
   - 不推荐原因说明
5. 评估方法说明
6. 附录

输出到：04_综合报告/【交付报告】{品牌}KOL筛选与评估报告.md
```

### 📤 产出文件

| 文件 | 说明 |
|------|------|
| `04_综合报告/【交付报告】{品牌}KOL筛选与评估报告.md` | 最终交付报告 |

### ✅ 验证方法

1. 报告结构完整
2. 数据与前序分析一致
3. 推荐结论清晰明确
4. 排版格式正确

### ⚠️ 注意事项

- 确保数据来源正确
- 推荐结论要有数据支撑
- 不推荐的KOL要说明原因

---

## 📋 常见问题处理

### Q1: KOL搜索不到

**原因**：昵称有特殊字符、已改名、非蒲公英博主
**解决**：
1. 尝试去掉emoji搜索
2. 手动在小红书搜索确认
3. 标记为无法获取，跳过

### Q2: API返回空数据

**原因**：非蒲公英博主、账号异常
**解决**：
1. 检查kol_id是否正确
2. 在蒲公英平台验证
3. 记录并在报告中说明

### Q3: Gemini 403错误

**原因**：上传的文件过期（处理时间过长）
**解决**：
1. 脚本已实现重试
2. 重新运行会自动跳过已完成的
3. 如持续失败，检查视频文件是否损坏

### Q4: JSON解析错误

**原因**：AI返回不完整或格式错误
**解决**：
1. 查看raw_response.txt原始返回
2. 脚本已实现自动修复不完整JSON
3. 如仍失败，标记为分析失败

### Q5: 数据类型错误

**原因**：API返回的字段类型不一致（如字符串vs数字）
**解决**：
1. 在使用前显式类型转换
2. 加try-except处理
3. 空值使用默认值

---

## 📁 项目模板目录结构

```
{项目名称}/
├── 00_需求和设计/
│   ├── 原始需求.md
│   ├── 执行步骤.md
│   └── API调用优化方案.md
├── 01_KOL数据获取/
│   ├── kol_list.json
│   ├── fetch_kol_ids.py
│   ├── fetch_screening_data.py
│   ├── fetch_detail_data.py
│   ├── search_results/
│   ├── 01_基础筛选数据/
│   │   ├── kol_{id}/
│   │   │   ├── kol_info.json
│   │   │   ├── kol_note_rate.json
│   │   │   └── kol_fans_trend.json
│   │   ├── _fetched_record.json
│   │   └── 筛选分析报告.md
│   └── 02_详细数据/
│       ├── kol_{id}/
│       │   ├── kol_fans_portrait.json
│       │   ├── kol_fans_summary.json
│       │   ├── kol_note_list.json
│       │   ├── kol_data_summary_v1.json
│       │   ├── kol_data_summary_v2.json
│       │   ├── kol_cost_effective.json
│       │   └── kol_core_data.json
│       ├── _all_kol_data.json
│       └── _fetched_record.json
├── 02_数据分析/
│   ├── run_analysis.py
│   └── output/
│       ├── 综合分析报告.md
│       └── analysis_data.json
├── 03_内容分析/
│   ├── 01_脚本/
│   │   ├── fetch_video_details.py
│   │   ├── download_videos.py
│   │   └── analyze_videos.py
│   ├── 02_视频数据/
│   │   ├── video_list.json
│   │   └── {kol_id}/*.mp4
│   ├── 03_分析结果/
│   │   ├── kol_{id}/
│   │   │   ├── *_analysis.json
│   │   │   ├── *_raw_response.txt
│   │   │   ├── *_综合评估.json
│   │   │   └── *_综合评估报告.md
│   │   ├── KOL横向比较报告.md
│   │   └── KOL横向比较数据.json
│   └── prompts/
│       └── video_analysis_prompt.txt
├── 04_综合报告/
│   └── 【交付报告】{品牌}KOL筛选与评估报告.md
├── README.md
└── 【SOP】KOL筛选与分析项目Runbook.md
```

---

## ✅ 项目完成检查清单

| 阶段 | 检查项 | 状态 |
|------|--------|------|
| 阶段0 | 目录结构创建完成 | ☐ |
| 阶段0 | kol_list.json 包含所有候选 | ☐ |
| 阶段1 | 所有KOL获取到ID | ☐ |
| 阶段1 | 搜索结果已保存 | ☐ |
| 阶段2 | 3个API数据获取完成 | ☐ |
| 阶段2 | 筛选报告已生成 | ☐ |
| 阶段3 | 人工确认筛选结果 | ☐ |
| 阶段4 | 7个API数据获取完成 | ☐ |
| 阶段4 | 数据合并完成 | ☐ |
| 阶段5 | 六维度分析完成 | ☐ |
| 阶段5 | 数据分析报告已生成 | ☐ |
| 阶段6.1 | 视频详情获取完成 | ☐ |
| 阶段6.2 | 视频下载完成 | ☐ |
| 阶段6.3 | AI分析完成 | ☐ |
| 阶段6.3 | 横向比较报告已生成 | ☐ |
| 阶段7 | 综合交付报告已生成 | ☐ |

---

*本Runbook基于能量棒项目实践总结，可根据具体项目需求调整*
