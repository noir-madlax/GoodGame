# 能量棒KOL分析 - 执行步骤

> **创建时间**: 2025-12-11  
> **状态**: 待Review

---

## 执行总览

```
阶段1: KOL ID获取 → 阶段2: 基础筛选数据 → 阶段3: 基础筛选 
→ 阶段4: 详细数据获取 → 阶段5: 数据分析 → 阶段6: 内容分析 
→ 阶段7: 报告生成
```

---

## 阶段1: KOL ID获取

### 目标
将15个KOL昵称转换为蒲公英平台的 `kol_id`

### 方法
1. 使用搜索API根据昵称搜索KOL
2. 或手动在蒲公英平台查找

### 输出
- `01_KOL数据获取/kol_list.json` - KOL名称和ID映射

### API调用
- 搜索API: ~15次

---

## 阶段2: 基础筛选数据获取 ⭐ 优化点

### 目标
仅获取筛选所需的**必要数据**，避免对不合格KOL浪费API调用

### 获取的API（每KOL 3个）

| API | 用途 | 筛选价值 |
|-----|------|----------|
| `kol_info` | 基本信息 | 判断是否蒲公英博主、粉丝数 |
| `kol_note_rate` | 笔记数据率 | 阅读/互动中位数、发帖数 |
| `kol_fans_trend` | 粉丝趋势 | 30天增长趋势 |

### API调用估算
- 15 KOL × 3 API = **45次**

### 输出
- `01_KOL数据获取/01_基础筛选数据/kol_{id}/` - 每个KOL的基础数据

---

## 阶段3: 基础筛选

### 目标
根据基础数据进行初步筛选，剔除明显不合格的KOL

### 筛选条件

| 条件 | 说明 | 淘汰场景 |
|------|------|----------|
| 蒲公英博主 | `kol_info` 返回code=0 | API返回错误则非蒲公英博主 |
| 粉丝数范围 | 根据品牌需求 | 粉丝过少或过多 |
| 数据表现 | 阅读/互动中位数 | 数据表现过差 |
| 增长趋势 | 30天粉丝趋势 | 持续负增长 |

### 预估结果
- 输入: 15人
- 预计通过: 10-12人
- 预计淘汰: 3-5人

### 输出
- `01_KOL数据获取/screening_result.json` - 筛选结果
- 包含：通过名单、淘汰名单及原因

---

## 阶段4: 详细数据获取

### 目标
仅对**通过筛选的KOL**获取完整详细数据

### 获取的API（每KOL 7个）

| API | 用途 |
|-----|------|
| `kol_fans_portrait` | 粉丝画像（年龄、性别、地域） |
| `kol_fans_summary` | 粉丝质量（活跃度、互动率） |
| `kol_note_list` | 笔记列表（用于后续分析） |
| `kol_data_summary_v1` | 数据汇总V1 |
| `kol_data_summary_v2` | 数据汇总V2 |
| `kol_cost_effective` | 性价比数据 |
| `kol_core_data` | 核心数据（日维度） |

### API调用估算
- 假设12人通过筛选: 12 × 7 = **84次**

### 输出
- `01_KOL数据获取/02_详细数据/kol_{id}/` - 每个KOL的完整数据

---

## 阶段5: 数据分析

### 目标
对通过筛选的KOL执行6个维度的数据分析

### 分析维度

| 序号 | 维度 | 脚本 | 输出目录 |
|------|------|------|----------|
| 1 | 粉丝增长趋势 | `analyze_fans_growth.py` | `02_数据分析/01_粉丝增长趋势/output/` |
| 2 | 发帖频率 | `analyze_post_frequency.py` | `02_数据分析/02_发帖频率/output/` |
| 3 | 数据表现 | `analyze_data_performance.py` | `02_数据分析/03_数据表现/output/` |
| 4 | 粉丝vs数据比例 | `analyze_fans_ratio.py` | `02_数据分析/04_粉丝vs数据比例/output/` |
| 5 | 爆文情况 | `analyze_hot_notes.py` | `02_数据分析/05_爆文情况/output/` |
| 6 | 互动趋势 | `analyze_interaction_trend.py` | `02_数据分析/06_互动趋势/output/` |

### API调用
- 无（本地数据处理）

---

## 阶段6: 内容分析

### 目标
对KOL的视频内容进行AI分析，评估内容质量

### 步骤

#### 6.1 视频筛选
- 每位KOL选取TOP 5非广告视频
- 按互动数排序

#### 6.2 获取视频详情
- API: `note_detail_solar`
- 获取视频URL、封面、正文等

#### 6.3 下载视频
- HTTP下载到本地
- 保存到 `03_内容分析/02_视频数据/kol_{id}/`

#### 6.4 AI分析
- 使用Gemini多模态分析
- 评估：博主形象、剪辑风格、口播能力

### API调用估算
- 视频详情: 12 × 5 = **60次**
- Gemini分析: **60次**

### 输出
- `03_内容分析/03_分析结果/kol_{id}/` - 每个视频的分析结果

---

## 阶段7: 综合报告生成

### 目标
汇总所有分析结果，生成最终交付报告

### 输出
- `04_综合报告/output/KOL综合分析报告.md`
- `04_综合报告/output/KOL排名对比.md`

---

## API调用汇总

| 阶段 | API | 调用次数 |
|------|-----|----------|
| 阶段1 | 搜索API | ~15 |
| 阶段2 | kol_info/note_rate/fans_trend | 45 |
| 阶段4 | 详细数据API×7 | ~84 |
| 阶段6 | note_detail_solar | ~60 |
| **总计** | | **~204次** |

### 对比原方案

| 方案 | API调用 | 说明 |
|------|---------|------|
| 原方案（全量） | 15×10 + 60 = 210 | 所有KOL获取全部API |
| 优化方案（分阶段） | 45 + 84 + 60 = ~189 | 筛选后再获取详细 |
| **节省** | **~21次** | 约10%（取决于淘汰人数） |

---

## 执行命令

```bash
# 进入后端目录并激活虚拟环境
cd /Users/rigel/project/hdl-tikhub-goodgame/backend
source .venv/bin/activate

# 阶段1: 获取KOL ID（待创建脚本）
python "test/redbook/能量棒分析/01_KOL数据获取/fetch_kol_ids.py"

# 阶段2: 获取基础筛选数据（待创建脚本）
python "test/redbook/能量棒分析/01_KOL数据获取/fetch_screening_data.py"

# 阶段3: 执行基础筛选（待创建脚本）
python "test/redbook/能量棒分析/01_KOL数据获取/run_screening.py"

# 阶段4: 获取详细数据（待创建脚本）
python "test/redbook/能量棒分析/01_KOL数据获取/fetch_detail_data.py"

# 阶段5: 数据分析（待创建脚本）
python "test/redbook/能量棒分析/02_数据分析/run_all_analysis.py"

# 阶段6: 内容分析
python "test/redbook/能量棒分析/03_内容分析/01_脚本/fetch_video_details.py"
python "test/redbook/能量棒分析/03_内容分析/01_脚本/download_videos.py"
python "test/redbook/能量棒分析/03_内容分析/01_脚本/analyze_videos.py"

# 阶段7: 生成报告
python "test/redbook/能量棒分析/04_综合报告/generate_report.py"
```

---

## 待创建的脚本

### 阶段1-4 脚本
- [ ] `01_KOL数据获取/fetch_kol_ids.py` - 搜索获取KOL ID
- [ ] `01_KOL数据获取/fetch_screening_data.py` - 获取基础筛选数据
- [ ] `01_KOL数据获取/run_screening.py` - 执行筛选逻辑
- [ ] `01_KOL数据获取/fetch_detail_data.py` - 获取详细数据
- [ ] `01_KOL数据获取/import_to_db.py` - 导入数据库

### 阶段5 脚本（可复用pillow项目）
- [ ] `02_数据分析/01_粉丝增长趋势/analyze_fans_growth.py`
- [ ] `02_数据分析/02_发帖频率/analyze_post_frequency.py`
- [ ] `02_数据分析/03_数据表现/analyze_data_performance.py`
- [ ] `02_数据分析/04_粉丝vs数据比例/analyze_fans_ratio.py`
- [ ] `02_数据分析/05_爆文情况/analyze_hot_notes.py`
- [ ] `02_数据分析/06_互动趋势/analyze_interaction_trend.py`

### 阶段6-7 脚本
- [ ] `03_内容分析/01_脚本/fetch_video_details.py`
- [ ] `03_内容分析/01_脚本/download_videos.py`
- [ ] `03_内容分析/01_脚本/analyze_videos.py`
- [ ] `04_综合报告/generate_report.py`

---

*最后更新: 2025-12-11*
